<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Futuristic Floating City in AR</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
    <script src="https://unpkg.com/aframe-drag-look-controls-component/dist/aframe-drag-look-controls-component.min.js"></script>

    <!-- Zoom Handling Script -->
    <script>
        AFRAME.registerComponent('zoom-control', {
            schema: {
                minZoom: { type: 'number', default: 1 },
                maxZoom: { type: 'number', default: 10 }
            },
            init: function () {
                var cameraEl = this.el;
                var zoomLevel = 5;

                // Mouse wheel event for zoom on desktop
                window.addEventListener('wheel', function (event) {
                    if (event.deltaY < 0) {
                        zoomLevel = Math.max(cameraEl.getAttribute('position').z - 0.2, this.data.minZoom);
                    } else {
                        zoomLevel = Math.min(cameraEl.getAttribute('position').z + 0.2, this.data.maxZoom);
                    }
                    cameraEl.setAttribute('position', {x: 0, y: 1.6, z: zoomLevel});
                });

                // Pinch to zoom for mobile devices
                var initialDistance = null;
                window.addEventListener('touchmove', function (event) {
                    if (event.touches.length === 2) {
                        var touch1 = event.touches[0];
                        var touch2 = event.touches[1];
                        var currentDistance = Math.sqrt(Math.pow(touch2.clientX - touch1.clientX, 2) + Math.pow(touch2.clientY - touch1.clientY, 2));
                        
                        if (!initialDistance) {
                            initialDistance = currentDistance;
                        } else {
                            var zoomFactor = (initialDistance - currentDistance) * 0.01;
                            zoomLevel = Math.max(Math.min(cameraEl.getAttribute('position').z + zoomFactor, this.data.maxZoom), this.data.minZoom);
                            cameraEl.setAttribute('position', {x: 0, y: 1.6, z: zoomLevel});
                            initialDistance = currentDistance;
                        }
                    }
                });

                // Reset distance on touch end
                window.addEventListener('touchend', function () {
                    initialDistance = null;
                });
            }
        });
    </script>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs>
        <!-- Global Lighting for the Scene -->
        <a-light type="ambient" color="#ffffff" intensity="0.5"></a-light>
        <a-light type="directional" position="2 4 5" intensity="1" castShadow="true"></a-light>

        <!-- Custom Pattern Marker (Make sure ar_marker.patt is correctly uploaded) -->
        <a-marker type="pattern" url="ar_marker.patt">
            
            <!-- Futuristic Skyscraper as the City Hub -->
            <a-box id="cityHub" position="0 0 0" depth="0.8" height="2" width="0.8"
                   material="color: #5DADE2; emissive: #0040FF; emissiveIntensity: 0.6;" 
                   animation="property: rotation; to: 0 360 0; loop: true; dur: 20000"></a-box>
            
            <!-- Flying Car Orbiting Around the City Hub -->
            <a-entity id="carOrbit" position="0 0 0" animation="property: rotation; to: 0 360 0; loop: true; dur: 10000">
                <a-box id="flyingCar" position="1.5 0.5 0" depth="0.2" height="0.1" width="0.4"
                       material="color: #FF5733; emissive: #FF3333; emissiveIntensity: 0.5;" 
                       animation="property: rotation; to: 0 360 0; loop: true; dur: 5000">
                </a-box>
            </a-entity>

            <!-- Drone Orbiting Around the City Hub -->
            <a-entity id="droneOrbit" position="0 0 0" animation="property: rotation; to: 0 360 0; loop: true; dur: 12000">
                <a-cylinder id="drone" position="2 1 0" radius="0.1" height="0.1"
                            material="color: #AED6F1; emissive: #33FF57; emissiveIntensity: 0.8;"
                            animation="property: rotation; to: 0 360 0; loop: true; dur: 8000">
                </a-cylinder>
            </a-entity>

            <!-- Floating City Block Orbiting Around the City Hub -->
            <a-entity id="blockOrbit" position="0 0 0" animation="property: rotation; to: 0 360 0; loop: true; dur: 15000">
                <a-box id="cityBlock" position="2.5 0.5 0" depth="0.5" height="0.3" width="0.5"
                       material="color: #58D68D; emissive: #00FF00; emissiveIntensity: 0.7;" 
                       animation="property: rotation; to: 0 360 0; loop: true; dur: 6000">
                </a-box>
            </a-entity>

        </a-marker>

        <!-- Camera with Drag Controls and Zoom Controls -->
        <a-entity camera look-controls drag-look-controls zoom-control></a-entity>
    </a-scene>
</body>
</html>
